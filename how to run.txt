# ============================================================
# ğŸŒ©ï¸ MULTI-CLOUD CSPM DASHBOARD â€” FULL SETUP & EXECUTION GUIDE
# ============================================================
# Works for Azure, AWS, GCP, and OCI on Windows (PowerShell)
# ============================================================

# ---- 1ï¸âƒ£ Navigate to Project Directory ----
cd "C:\Users\arinv\Downloads\My Projects\cspm_project"

# ---- 2ï¸âƒ£ Allow Script Execution for This Session ----
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# ---- 3ï¸âƒ£ Create and Activate Python Virtual Environment ----
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# ---- 4ï¸âƒ£ Install Dependencies ----
pip install -r requirements.txt

# ---- 5ï¸âƒ£ Install Cloud CLIs (Run only once per provider) ----
# Azure CLI
#   https://aka.ms/installazurecliwindows
# AWS CLI
#   https://awscli.amazonaws.com/AWSCLIV2.msi
# GCP CLI
#   https://cloud.google.com/sdk/docs/install
# OCI CLI
#   https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm#Quickstart

# ---- 6ï¸âƒ£ Authenticate to Your Cloud Account ----

# ---- For Azure ----
az login
az account show
# (You should see your Azure for Students subscription JSON output)

# ---- For AWS ----
# aws configure
# Enter Access Key, Secret Key, Region, Output=json
# aws sts get-caller-identity

# ---- For GCP ----
# gcloud init
# gcloud config list account

# ---- For OCI ----
# oci setup config
# oci os ns get

# ---- 7ï¸âƒ£ Run Your Flask App ----
python app.py

# Youâ€™ll see:
#  * Running on http://127.0.0.1:5000
#  * Debugger active

# ---- 8ï¸âƒ£ Open in Browser ----
# Navigate to:
# http://127.0.0.1:5000
# Then click â€œDetect Cloudâ€ â†’ it will detect whichever cloud CLI is logged in.

# âœ… Example Outputs:
# Azure  -> "Detected Cloud: AZURE"
# AWS    -> "Detected Cloud: AWS"
# GCP    -> "Detected Cloud: GCP"
# OCI    -> "Detected Cloud: OCI"
# Unknown-> "No supported cloud detected."

# ---- 9ï¸âƒ£ Run Security Audit and Fix Misconfigurations ----
# From the UI:
#   Click â€œRun Auditâ€ â†’ executes scripts/{cloud}_*.sh
#   Click â€œApply Fixesâ€ â†’ automatically repairs misconfigs
# Reports are saved in:
#   reports/security_audit_report.json

# ---- ğŸ” Optional: Create Sample Misconfigurations for Testing ----
# --- Azure ---
# az storage account create -n insecurestorage$RANDOM -g MyResourceGroup --allow-blob-public-access true
# az network nsg rule create -g MyResourceGroup --nsg-name defaultNSG --name openAll --priority 100 --access Allow --direction Inbound --protocol "*" --source-address-prefixes "*" --destination-port-ranges "*"

# --- AWS ---
# aws s3api create-bucket --bucket mypublicbucket123 --region us-east-1
# aws s3api put-bucket-acl --bucket mypublicbucket123 --acl public-read

# --- GCP ---
# gsutil mb gs://public-test-bucket-$RANDOM
# gsutil iam ch allUsers:objectViewer gs://public-test-bucket-$RANDOM

# --- OCI ---
# oci os bucket create --name public-bucket-$RANDOM --public-access-type ObjectRead

# ---- ğŸ”§ Run Audit Again to See Detected Misconfigs ----
# Then click â€œApply Fixesâ€ to automatically repair them.

# ---- ğŸ” View Report ----
# Click â€œView Reportâ€ in the dashboard, or manually open:
#   reports/security_audit_report.json

# ---- ğŸ§± Stop Flask ----
# Ctrl + C

# ---- ğŸšª Deactivate Virtual Environment ----
deactivate

# ============================================================
# âœ… SUMMARY
# ------------------------------------------------------------
# This setup:
#  - Detects which cloud (Azure, AWS, GCP, OCI) is active
#  - Audits security misconfigurations using scripts/
#  - Applies fixes automatically
#  - Generates a detailed JSON report
#  - Works cross-platform (Windows/Linux)
# ============================================================
